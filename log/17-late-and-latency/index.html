<!doctype html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><meta content=ekunazanu name=author><meta content="Things have been slow recently." name=description><meta content="Late and Latency" property=og:title><meta content=article property=og:type><meta content="Things have been slow recently." property=og:description><meta content=https://ekunazanu.foo/log/17-late-and-latency/ property=og:url><meta content=https://ekunazanu.foo/thumbnails/log.17.ecg.avif.png property=og:image><meta content="A rough doodle of an ECG graph." property=og:image:alt><meta content=image/png property=og:image:type><meta content=1200 property=og:image:width><meta content=900 property=og:image:height><meta content=en_US property=og:locale><meta content=ekunazanu.foo property=og:site_name><title>Late and Latency ~ ekunazanu.foo</title><link href=https://ekunazanu.foo/log/17-late-and-latency/ rel=cannonical><link href=https://ekunazanu.foo/atom.xml rel=alternate type=application/atom+xml><link href=https://ekunazanu.foo/misc/main.css rel=stylesheet><link href=https://ekunazanu.foo/misc/favicon.png rel=icon><meta content=Zola name=generator><body><nav><ul><li><h2><a href=https://ekunazanu.foo>ekunazanu.foo</a></h2><li><a href=https://ekunazanu.foo/log>Log</a> ⟶<li><a href=https://ekunazanu.foo/lab>Lab</a></ul></nav><div class=print>https://ekunazanu.foo</div><main><article><h1>Late and Latency</h1><p>Okay I am making this post only because my classmate asked me to do it. The internet in our campus has been hot garbage lately, and he pointed out to me that it internet is only horrible on Firefox. I told him it was probably just selection bias. But I found the claim interesting enough that I came back to my room, and ran some ping tests. And of course, the spikes in latency existed independent of a browser.<p><canvas aria-label="a chart showing an inconsitent ping latency, with time on x axis and latency on y axis" id=canvasLatencyGraph0 role=img></canvas><details open><summary>Ping tests</summary> <p>I just wrote a quick dirty script to store the start pings every thirty seconds, and log the start and end times, and latency values. Cleaned the data using some basic python, and visualized it by re-using code from another <a href=/lab/quantifying-colour>lab post</a>.</p> <pre><code>#!/bin/env sh
<p>HOST="google.com"
WAIT=30
RUNS=60</p>
<p>while true; do
START="$(date)"
echo "start $START" > "$START.log" && ping -c $RUNS -i 1 $HOST &>> "$START.log" && echo "end $(date)" >> "$START.log" &
sleep $WAIT
done
</code></pre></details><p>There are some big spikes whenever a new ping session begins. The number of people on campus increased by quite a lot recently, so maybe it’s the ISP struggling to handle new demand? Or maybe intentional throttling? I don’t know. But one thing was clear: The latency spikes and dropped packets happen the most frequently at the beginning of new ‘connections’. I am not sure how ICMP works but I think it’s pretty similar in how I have been experiencing it — starting new TCP connections aka. opening new tabs and sites feel ridiculously slow, but downloads and bandwidth is otherwise fine.<p>So if I could just route all connections via a single connection — ie. set up a tunnel — it should make the internet slightly less rage inducing. I already run a <a href=/log/6-back-on-track/>tunnel via Cloudflare for my RPi server</a>. I don’t want to run a CF service running on my personal PC though. I already have a WireGuard config set up, and so all I need to go is turn that on.<p><canvas aria-label="a chart showing consitent latency, with time on x axis and latency on y axis" id=canvasLatencyGraph1 role=img></canvas><p>Sure enough, with a WireGuard instance on, the average latency was slightly higher but no more spikes. And the difference in browsing experience was night and day. Told the ‘hack’ to the person who led me down this rabbit hole — asking him to use a VPN — and he could feel the differences so much that he was impressed and asked me to make a post on it.<p><img alt="doodle of a person explaining to a surprised person that the solution was just using a vpn" decoding=async loading=lazy src=/media/log/vpn-solution.avif><p>In other news, the grind for jobs is going decent. Cleared the initial rounds for a couple of companies, but not good enough. Maybe I started a bit too late in my prep, but better late than never. The grind continues. The lambo dream lives on.<p>Cya next month.</p><script>const WIDTH = 1280;
const graphColors = ["#922", "#6a8", "#22d", "#777"];
const pingLatencies = [
    [ // without wireguard
        [1864, 19.4, 18.8, 43.1, 20.0, 19.2, 16.9, 22.1, 25.1, 17.1, 65.2, 19.0, 224, 29.5, 116, 54.5, 17.5, 18.8, 17.7, 21.0, 18.3, 19.3, 18.3, 18.4, 17.0, 22.2, 17.3, 23.4, 17.3, 17.8, 18.6, 19.3, 17.2, 19.5, 17.5, 16.9, 18.3, 18.4, 20.7, 28.8, 17.1, 17.2, 21.0, 17.0, 17.7, 16.9, 18.7, 19.5, 17.8, 17.4, 17.6, 26.8, 74.5, 18.8, 18.2, 18.4, 17.4, 17.2, 18.4, 17.3],
        [1611, 18.8, 17.6, 21.4, 20.0, 16.7, 24.3, 20.5, 17.9, 19.4, 16.9, 22.7, 18.0, 18.1, 19.1, 19.5, 19.9, 17.5, 21.0, 17.6, 20.2, 19.6, 18.0, 20.1, 19.3, 19.4, 17.3, 17.1, 20.1, 17.8, 17.0, 17.7, 18.7, 22.5, 19.5, 19.5, 17.5, 19.0, 17.3, 17.3, 17.4, 18.8, 18.4, 17.6, 19.7, 17.2, 119, 17.5, 110, 39.6, 105, 97.7, 18.9, 18.3, 17.1, 27.7, 22.2, 17.7, 18.5, 18.0],
        [1398, 17.4, 20.3, 17.3, 18.5, 18.1, 16.9, 18.9, 17.3, 19.0, 17.1, 19.6, 18.6, 19.2, 20.0, 22.0, 136, 32.1, 128, 56.9, 99.6, 116, 17.8, 17.9, 17.5, 19.5, 18.0, 18.8, 17.5, 17.2, 17.7, 17.7, 17.7, 18.9, 18.3, 18.8, 17.4, 17.4, 28.2, 18.1, 18.6, 20.1, 30.2, 17.8, 18.1, 18.2, 23.4, 18.2, 17.9, 22.1, 17.7, 18.2, 18.0, 19.5, 18.0, 19.8, 18.5, 20.2, 18.9, 18.9],
        [1727, 17.7, 17.7, 17.7, 18.9, 18.3, 18.8, 17.4, 17.4, 28.2, 18.1, 18.6, 20.1, 30.2, 17.8, 18.1, 18.2, 23.4, 18.2, 17.9, 22.1, 17.7, 18.2, 18.0, 19.5, 18.0, 19.8, 18.5, 20.2, 18.9]
    ],
    [ // with wireguard
        [199, 213, 199, 203, 199, 199, 201, 299, 217, 309, 356, 262, 285, 201, 199, 200, 200, 200, 204, 201, 200, 200, 200, 201, 200, 200, 200, 206, 201, 199, 202, 200, 253, 199, 201, 200, 212, 199, 201, 206, 201, 200, 201, 200, 207, 200, 199, 200, 199, 341, 205, 198, 199, 201, 229, 202, 237, 200, 209, 200],
        [200, 199, 201, 198, 198, 200, 199, 198, 200, 199, 216, 198, 200, 240, 271, 320, 300, 291, 200, 204, 198, 199, 224, 199, 200, 198, 201, 200, 199, 198, 198, 199, 201, 201, 199, 200, 199, 199, 206, 200, 199, 200, 198, 199, 200, 207, 199, 198, 200, 201, 228, 200, 199, 200, 235, 199, 200, 200, 200, 199],
        [198, 198, 198, 199, 201, 199, 214, 198, 202, 198, 208, 198, 198, 198, 198, 198, 201, 199, 214, 305, 281, 328, 307, 222, 205, 199, 199, 205, 200, 200, 198, 200, 207, 200, 199, 199, 230, 200, 201, 199, 199, 203, 200, 199, 199, 207, 199, 200, 198, 212, 202, 198, 202, 199, 199, 199, 200, 199, 204, 199],
        [199, 214, 203, 202, 202, 200, 201, 210, 200, 199, 199, 212, 200, 203, 203, 199, 201, 199, 207, 227, 226, 200, 200, 199, 202, 200, 200, 199, 205, 273]
    ],
];

let canvasLatencies = [];
for (let canvas = 0; canvas < pingLatencies.length; canvas++) {
    canvasLatencies[canvas] = initializeCanvas(`canvasLatencyGraph${canvas}`, 300);
    console.log(canvas, canvasLatencies[canvas])
    for (let line = 0; line < pingLatencies[canvas].length; line++)
        drawGraph(canvasLatencies[canvas], pingLatencies[canvas][line], graphColors[line], line * 30); // 30 is wait time 
    drawAxes(canvasLatencies[canvas]);
}

function drawGraph(canvas, values, color = "#000", start = 0, end = 60, scale = 1 / 2000, colorAxes = "#000", y = 300, width = 2) {
    canvas.lineWidth = width;
    canvas.strokeStyle = color;
    canvas.beginPath();
    canvas.moveTo(start * 10 + 55, y * (1 - values[0] * scale * 0.76) - 49);
    for (let i = 0; i < 60; i++)
        canvas.lineTo((i + start) * 10 + 55, y * (1 - values[i] * scale * 0.76) - 49);
    canvas.stroke();
    console.log(values, start, end);
}

function drawAxes(canvas, y = 300, color = "#000", width = 2) {
    canvas.lineWidth = width;
    canvas.strokeStyle = color;
    canvas.beginPath();
    canvas.moveTo(55, 15);
    canvas.lineTo(55, y - 45);
    canvas.lineTo(WIDTH - 35, y - 45);
    canvas.stroke();
    initializeCanvasText(canvas);
    for (let i = 0; i < 6; i++)
        canvas.fillText(i * 20 + "s", i * 200 + 55, y - 25);
    canvas.fillText("1s", 25, (y - 60) / 2 + 15);
}

function initializeCanvas(canvasID, height, width = WIDTH) {
    const canvas = document.getElementById(canvasID).getContext("2d");
    canvas.canvas.width = width;
    canvas.canvas.height = height;
    return canvas;
}

function initializeCanvasText(canvas, color = "#000", horizontal = "center", vertical = "middle", font = "25px JetBrains Mono") {
    canvas.font = font;
    canvas.textBaseline = vertical;
    canvas.textAlign = horizontal;
    canvas.fillStyle = color;
}</script></article></main><footer><a href=https://ekunazanu.foo/more#Terms_of_Use>© 2025</a> <a href=https://ekunazanu.foo/about>ekunazanu</a> · <a rel="noopener nofollow noreferrer" href=https://creativecommons.org/licenses/by/4.0/ target=_blank>CC BY 4.0</a> · <a rel="noopener nofollow noreferrer" href=https://github.com/ekunazanu/ekunazanu.foo target=_blank>Source</a></footer>